@inject ISelectDateViewModel ViewModel
@inject IStringLocalizer<Resource> Localizer
@inject IZaptoLocalStorageService ZaptoLocalStorageService
@implements IDisposable

@if ((this.MinDate != null) && (this.MaxDate != null))
{
    <MudGrid Class="mb-4 mt-5">
        <MudItem xs="12" sm="6" md="3" Style="min-width:400px">
            <MudPaper Class="d-flex align-center gap-4" Style="height:90px;">
                <MudDatePicker @ref="this.StartDatePicker" Label="@Localizer["StartDate"]" Editable="true" MinDate="@MinDate.Value.Date" MaxDate="@MaxDate.Value.Date" @bind-Date="StartDate" Placeholder="@Localizer["SelectDate"]" Class="mx-10" AutoClose="false">
                    <PickerActions>
                        <MudButton OnClick="@(() => this.CloseStartDatePicker(false))">Cancel</MudButton>
                        <MudButton Color="Color.Primary" OnClick="@(() => this.CloseStartDatePicker(true))">Ok</MudButton>
                    </PickerActions>
                </MudDatePicker>
            </MudPaper>
        </MudItem>
        <MudItem xs="12" sm="6" md="3" Style="min-width:400px">
            <MudPaper Class="d-flex align-center gap-4" Style="height:90px;">
                <MudDatePicker @ref="this.EndDatePicker" Label="@Localizer["EndDate"]" Editable="true" MinDate="@MinDate.Value.Date" MaxDate="@MaxDate.Value.Date" @bind-Date="EndDate" Placeholder="@Localizer["SelectDate"]" Class="mx-10" AutoClose="false">
                    <PickerActions>
                        <MudButton OnClick="@(() => this.CloseEndDatePicker(false))">Cancel</MudButton>
                        <MudButton Color="Color.Primary" OnClick="@(() => this.CloseEndDatePicker(true))">Ok</MudButton>
                    </PickerActions>
                </MudDatePicker>
            </MudPaper>
        </MudItem>
    </MudGrid>
}

@code
{
    #region Properties
    MudBaseDatePicker? StartDatePicker;

    MudBaseDatePicker? EndDatePicker;

    [Parameter]
    public DateTime? StartDate { get; set; } = DateTime.Today;

    [Parameter]
    public DateTime? EndDate { get; set; } = DateTime.Today;

    [Parameter]
    public DateTime? MaxDate { get; set; }

    [Parameter]
    public DateTime? MinDate { get; set; }

    [Parameter]
    public EventCallback<DateTime?> StartDateChanged { get; set; }

    [Parameter]
    public EventCallback<DateTime?> EndDateChanged { get; set; }
    #endregion

    #region Methods
    public void Dispose()
    {
    }

    private async void CloseStartDatePicker(bool submit)
    {
        this.StartDatePicker?.Close(submit);
        if (this.StartDate != null)
        {
            string res = this.StartDate.Value.ToShortDateString();
            await this.ZaptoLocalStorageService.SetItemAsync<string>("StartDate", res);
        }
    }

    private async void CloseEndDatePicker(bool submit)
    {
        this.EndDatePicker?.Close(submit);
        if (this.EndDate != null)
        {
            string res = this.EndDate.Value.ToShortDateString();
            await this.ZaptoLocalStorageService.SetItemAsync<string>("EndDate", res);
        }
    }
    #endregion
}
