@inject IWeatherViewModel? ViewModel 
@implements IDisposable

<MudGrid Class="mb-2">
    <MudItem xs="12" sm="6" md="3" Style="min-width:400px">
        <MudPaper Class="d-flex align-center gap-4" Style="height:100px;">
           @if (this.Model != null)
           {
                <MudImage Src="@this.Model?.Image"></MudImage>            
                <MudText Typo="Typo.h6" Align="Align.Left">@this.Model?.WeatherText</MudText>  
           }
           else
           {
                <MudProgressCircular Color="Color.Default" Class="ml-6" Indeterminate="true" />
           }            
        </MudPaper>
    </MudItem>
    <MudItem xs="12" sm="6" md="3" Style="min-width:400px">
        <MudPaper Class="d-flex align-center" Style="height:100px;">
            @if (this.Model != null)
            {
                <MudIcon Icon="@Icons.Material.Filled.Thermostat" Class="mx-2" Color="Color.Primary" Style="width:54px; height:54px;"></MudIcon>
                <MudStack>
                    <MudText Typo="Typo.h6" Class="ml-4">@this.Model?.TemperatureMax</MudText>
                    <MudText Typo="Typo.h5" Class="ml-4">@this.Model?.Temperature</MudText>
                    <MudText Typo="Typo.h6" Class="ml-4">@this.Model?.TemperatureMin</MudText>
                </MudStack>
                <MudText Typo="Typo.h5" Align="Align.Left" Class="mx-2">°C</MudText>
            }
            else
            {
                <MudProgressCircular Color="Color.Default" Class="ml-6" Indeterminate="true" />
            }   
        </MudPaper>
    </MudItem>
    <MudItem xs="12" sm="6" md="3" Style="min-width:400px">
        <MudPaper Class="d-flex align-center" Style="height:100px;">
            @if (this.Model != null)
            {
                if ((this.Model.WindDirection >= 22) && (this.Model.WindDirection < 67))
                {
                    <MudIcon Class="mx-2" Icon="@Icons.Material.Filled.NorthEast" Color="Color.Primary" Style="width:54px; height:54px;"></MudIcon>
                }
                else if ((this.Model.WindDirection >= 67) && (this.Model.WindDirection < 112))
                {
                    <MudIcon Class="mx-2" Icon="@Icons.Material.Filled.East" Color="Color.Primary" Style="width:54px; height:54px;"></MudIcon>
                }
                else if ((this.Model.WindDirection >= 112) && (this.Model.WindDirection < 157))
                {
                    <MudIcon Class="mx-2" Icon="@Icons.Material.Filled.SouthEast" Color="Color.Primary" Style="width:54px; height:54px;"></MudIcon>
                }
                else if ((this.Model.WindDirection >= 157) && (this.Model.WindDirection < 202))
                {
                    <MudIcon Class="mx-2" Icon="@Icons.Material.Filled.South" Color="Color.Primary" Style="width:54px; height:54px;"></MudIcon>
                }
                else if ((this.Model.WindDirection >= 202) && (this.Model.WindDirection < 247))
                {
                    <MudIcon Class="mx-2" Icon="@Icons.Material.Filled.SouthWest" Color="Color.Primary" Style="width:54px; height:54px;"></MudIcon>
                }
                else if ((this.Model.WindDirection >= 247) && (this.Model.WindDirection < 292))
                {
                    <MudIcon Class="mx-2" Icon="@Icons.Material.Filled.West" Color="Color.Primary" Style="width:54px; height:54px;"></MudIcon>
                }
                else if ((this.Model.WindDirection >= 292) && (this.Model.WindDirection < 337))
                {
                    <MudIcon Class="mx-2" Icon="@Icons.Material.Filled.NorthWest" Color="Color.Primary" Style="width:54px; height:54px;"></MudIcon>
                }
                else 
                {
                    <MudIcon Class="mx-2" Icon="@Icons.Material.Filled.North" Color="Color.Primary" Style="width:54px; height:54px;"></MudIcon>
                }

                <MudText Typo="Typo.h5" Class="ml-4">@this.Model?.WindSpeed</MudText>
                <MudText Typo="Typo.h5" Align="Align.Left" Class="mx-2">km/h</MudText>
            }
            else
            {
                <MudProgressCircular Color="Color.Default" Class="ml-6" Indeterminate="true" />
            }
        </MudPaper>
    </MudItem>
    <MudItem xs="12" sm="6" md="3" Style="min-width:400px">
        <MudPaper Class="d-flex align-center" Style="height:100px;">
            @if (this.Model != null)
            {
                <MudText Typo="Typo.h4" Color="Color.Primary" Style="font-weight:bold" Class="ml-4">P</MudText>
                <MudText Typo="Typo.h6" Class="ml-4">@this.Model?.Pressure</MudText>
                <MudText Typo="Typo.h5" Align="Align.Left" Class="mx-2">hPa</MudText>
            }
            else
            {
                <MudProgressCircular Color="Color.Default" Class="ml-6" Indeterminate="true" />
            }
        </MudPaper>
    </MudItem>
</MudGrid>

@code 
{
    public WeatherModel? Model { get; set; }

    protected override async Task OnInitializedAsync()
    {
        if (this.ViewModel != null)
        {
            await this.ViewModel.InitializeAsync(null);
            this.Model = await this.ViewModel.GetWeatherModel();
            this.ViewModel.Refresh += RefreshView;
        }
    }

    public void Dispose()
    {
        if (this.ViewModel != null)
        {
            this.ViewModel.Refresh -= RefreshView;
            this.ViewModel?.Dispose();
            this.ViewModel = null;
        }
    }

    public void RefreshView(object? sender, EventArgs e)
    {
        this.StateHasChanged();
    }
}
